<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{background:#f5f7fb;}
.input-box{
  width:40px;height:50px;
  text-align:center;
  font-size:20px;
}
</style>
</head>

<body>

<header class="p-2 bg-white shadow-sm d-flex align-items-center">
  <button onclick="history.back()" class="btn btn-light">
    <i class="bi bi-arrow-left"></i>
  </button>
  <h6 id="title" class="mx-auto mb-0"></h6>
</header>

<main class="container py-3">

<section class="card p-3 mb-3">
  <ul id="questions"></ul>
</section>

<section id="inputs" class="d-flex justify-content-center gap-2 mb-3"></section>

<button class="btn btn-success w-100" onclick="submitAnswer()">Submit</button>

</main>

<script>
const url=new URLSearchParams(location.search);
let level=parseInt(url.get("level"));
let sub=parseInt(url.get("sub"));

let gameData;
let answer="";

fetch("data.json")
.then(res=>res.json())
.then(data=>{
  gameData=data;

  let lvl=data.levels.find(l=>l.level===level);
  let subData=lvl.sublevels.find(s=>s.sub===sub);

  document.getElementById("title").innerText=`Level ${level} - ${sub}`;

  answer=subData.answer.toUpperCase();

  let q="";
  subData.questions.forEach(i=>q+=`<li>${i}</li>`);
  document.getElementById("questions").innerHTML=q;

  let inp="";
  for(let i=0;i<answer.length;i++){
    inp+=`<input maxlength="1" class="form-control input-box">`;
  }
  document.getElementById("inputs").innerHTML=inp;
});

function submitAnswer(){
  let user="";
  document.querySelectorAll(".input-box").forEach(i=>{
    user+=i.value.toUpperCase();
  });

  if(user===answer){
    saveProgress();
    nextStep();
  }else{
    alert("Wrong answer");
  }
}

function saveProgress(){
  let progress=JSON.parse(localStorage.getItem("progress"))||{};
  if(!progress["level"+level])progress["level"+level]={};
  progress["level"+level]["sub"+sub]=true;
  localStorage.setItem("progress",JSON.stringify(progress));
}

function nextStep(){
  let lvl=gameData.levels.find(l=>l.level===level);

  if(sub<lvl.sublevels.length){
    location.href=`game.html?level=${level}&sub=${sub+1}`;
  }else{
    let progress=JSON.parse(localStorage.getItem("progress"))||{};
    progress["level"+level]=true;
    localStorage.setItem("progress",JSON.stringify(progress));
    location.href="index.html";
  }
}
</script>

</body>
</html>
